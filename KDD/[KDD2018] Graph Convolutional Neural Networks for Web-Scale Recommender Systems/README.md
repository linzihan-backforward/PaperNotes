# Graph Convolutional Neural Networks for Web-Scale Recommender Systems

------

## Motivation

​	使用GCN来处理图上的数据已经成为了一种常用的图处理方法，但是已有的方法都还无法直接部署在真实的生产环境中，因为生产环境的图是非常巨大的，包含几十亿的点和边，已有的方法中使用的一些假设和技巧，在如此巨大的图中都不再有效。因此，本文基于GCN设计了一个适用于超大规模数据的模型，并在真实的生产环境中取得了非常好的效果。

## Model

​	本模型所处理的问题是对于一个查询item，找到于其相似的item作为结果，其实就可以抽象为连接预测的问题，再加上本模型是GCN在工业场景下的应用模型，所以结构上的创新并不多，主要都是一些工业界的trick。本文的模型还是基于最基本的卷积操作，每一层卷积聚合邻居节点的信息和上一层的输出，各个节点之间共享同样的聚合神经网络参数。

![image-20200105100057896](https://github.com/linzihan-backforward/PaperNotes/blob/master/KDD/%5BKDD2018%5D%20Graph%20Convolutional%20Neural%20Networks%20for%20Web-Scale%20Recommender%20Systems/image-20200105100057896.png?raw=true)

​	为了这样的模型在巨大的图上能够很好的调参和收敛，本文主要介绍了一些在训练过程中的trick。

​	首先是如何确定邻居集合N（u），之前的一些方法往往定义u节点周围k跳之内的节点为邻居，但是在大图中这会导致计算量的不确定性，所以本文结合了random walk的方法，从节点u出发进行random walk，将每一个节点的visti count进行L1归一化之后排序，取前T个作为集合N（u）。这样不仅可以固定每一次需要聚合的邻居信息的数据量，同时归一化之后得到的分值还可以作为聚合操作的权重。

​	其次，为了降低模型的参数，本模型采用堆叠式的卷积，将上图中的1、2、3作为一个卷积层，多个卷积层上下相连，不同的卷积层之间采用不同的参数，但是每一层对于所有的节点使用相同的参数。

​	训练时采用的Loss为Hinge Loss，最大化查询和正样本的分值与查询和负样本的分值，这里的正样本来自数据中的查询对（q，i）即对于查询item q，其应当返回的item i，负样本来自于负采样，具体的方法下面有介绍。

### Training Tricks

​	因为所处理的是海量的生产环境数据，所以多GPU并行就是必须的了，多个GPU分别进行前向传播和后向传播，然后梯度被叠加之后进行同步的参数更新操作。

​	为了提高GPU的使用率，在训练中还构建了一个生产者-消费者模型，因为我们不能直接在整个图的邻接矩阵和特征矩阵上面进行运算，所以在每一个minibatch时，使用CPU来将其需要的节点和特征矩阵提前抽出来形成一个子图，这样在每一个batch内GPU就不需要再进行额外的数据交换，同时使用CPU的多线程技术也可以将整个训练的速度提升一倍。

​	对于负采样问题，本模型采用的是对于每一个正样本采样500个负样本，但是随机采样的话对于模型来说实在太过简单，因为我们的节点多大十亿个，其中与正样本相近的样本占比很小，所以采样得到的500个负样本都是与正样本差异极大的，模型根本无法有效的学到区分他们的能力。所以为了让模型能力够强，要采样一定的“难负样本”，使用的方法是用个性化PageRank的得分来进行粗排，选择2000~5000之间的样本作为难负样本，实验证明这样的方法对提升模型能力非常有效。

​	最后，在训练中为了模型能够收敛，使用一个难度递增的方式进行训练，即每一轮都新增一个“难负样本”来进行类似增量的训练。

​	在训练完成之后，预测的效率同样十分关键，在多层的卷积中有很多的节点是被重复计算的，所以为了避免这样的额浪费，使用MapReduce的方法来进行分布式处理。

## Experiments

### Datasets

​	本模型所目标的一直就是来自Pinterest的生产数据集，包含12亿的正样本。

### Baselines

- ​	Visual：仅仅使用节点的图片经过VGG-16后的embedding

- ​    Annotation：仅仅使用节点文本进行Word2Vec之后的embedding

- ​    Combined：将上面的两个embedding连起来

- ​    Pixie：在查询q上做random  walk将score排名TopK的作为推荐，不生成embedding

### Results

![image-20200105110937123](https://github.com/linzihan-backforward/PaperNotes/blob/master/KDD/%5BKDD2018%5D%20Graph%20Convolutional%20Neural%20Networks%20for%20Web-Scale%20Recommender%20Systems/image-20200105110937123.png?raw=true)

## 个人见解

​	这篇文章是一个纯的工业界文章，第一次将GCN框架应用在超大规模的生产数据中，所有的创新点都是一些实现和训练上的trick与学术界的模型对比非常明显。其证明了图结构的信息在真实环境下确实有很大的利用空间，给了GCN的发展一个强心针，在看惯了其他文章中各种复杂的花里胡哨的方法之后在看看这种工作，看看模型在真实的数据集上面work都需要面临哪些问题，还是感觉味道上非常不一样，唯一一个遗憾的地方是作者没有将代码开源，否则就可以详细看看各种技巧的实现方式了。